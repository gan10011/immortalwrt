name: Build Lean OpenWrt for ZN-M2

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 180
    
    steps:
    - name: Checkout OpenWrt
      uses: actions/checkout@v4
      with:
        repository: openwrt/openwrt
        ref: v23.05.3
        path: openwrt

    # ================================
    # 核心配置修改区 (保持不变)
    # ================================
    - name: Apply Device Specific Configuration
      run: |
        cd openwrt
        # [原有设备配置代码保持不变]
        
    # ================================
    # 依赖处理区
    # ================================
    - name: Setup Feeds
      run: |
        cd openwrt
        ./scripts/feeds update -a
        ./scripts/feeds install -a luci-app-openclash
  
